#!/bin/sh

ppp=/etc/ppp

printf "server: "
read server
printf "login: "
read login_name
printf "password: "
read pass
printf "dial name: "
read name

#clear all configs
echo > $ppp/l2tpd.conf
echo > $ppp/options.l2tp

printf "[global]
access control = yes
[lac $name]\nredial = yes
redial timeout = 1
require chap = yes
require authentication = no
lns = $server
name = $login_name
ppp debug = no
ppp profile = $ppp/options.l2tp
require pap = no
autodial = yes" >> $ppp/l2tpd.conf

printf "unit 0
name $login_name
remotename l2tp
ipparam $name
connect /bin/true
mru 1460
mtu 1460
nodeflate
persist
maxfail 0
nopcomp
noaccomp
defaultroute
replacedefaultroute" >> $ppp/options.l2tp

echo "Setup of $ppp/chap-secrets"
printf "$login_name * $pass" >> $ppp/chap-secrets

fs save

echo "OK"
